(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_opened"),document.addEventListener("keydown",T)}function n(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",T)}function o(){var e=document.querySelectorAll(".form"),t=document.querySelectorAll(".form__input-error"),n=document.querySelectorAll(".form__textfield"),o=document.querySelectorAll(".form__submit-button");e.forEach((function(e){t.forEach((function(t){n.forEach((function(n){o.forEach((function(o){e.reset(),t.textContent="",n.classList.remove("form__textfield_type_error"),o.disabled=!0,o.classList.add("form__submit-button_inactive")}))}))}))}))}e.d({},{xH:()=>M,YX:()=>J,CL:()=>N});var c=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19",headers:{authorization:"f92b5f7d-6bec-4339-b0cf-17fe28ece879","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},i=document.querySelector(".popup-img"),l=i.querySelector(".popup__image"),s=i.querySelector(".popup__img-caption"),u=document.querySelector(".add-form"),d=document.querySelector(".popup-delete"),f=document.querySelector(".delete-form__submit-button"),_=function e(t){var o,c=t.closest(".place");(o=c.id,fetch("".concat(r.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:r.headers}).then(a)).then((function(e){c.remove()})).catch((function(e){console.log(e)})).then(n(d)).finally((function(){f.removeEventListener("click",(function(){e(t)}))}))},p=function e(n){t(d),f.classList.remove("form__submit-button_inactive"),f.addEventListener("click",(function(){_(n)})),n.removeEventListener("click",e)};function m(e,n,o,c,u,d){var f=e.querySelector(".place").cloneNode(!0),_=f.querySelector(".place__image"),m=f.querySelector(".place__like"),v=f.querySelector(".place__like-count"),h=f.querySelector(".place__delete-button");return f.querySelector(".place__name").textContent=n,_.src=o,_.classList.add("place__image_size"),_.alt=n,v.textContent=c.length,f.id=d,Array.from(c).forEach((function(e){e._id===J&&m.classList.add("place__like_active")})),m.addEventListener("click",(function(){!function(e,t,n){e.classList.contains("place__like_active")?e.classList.contains("place__like_active")&&t.textContent>=1&&(t.textContent=n.length+1-1):t.textContent=n.length+1}(m,v,c),m.classList.contains("place__like_active")?function(e,t,n,o){return(c=o.id,fetch("".concat(r.baseUrl,"/cards/likes/").concat(c),{method:"DELETE",headers:r.headers}).then(a)).then((function(o){e.classList.contains("place__like_active")&&t.textContent>0&&(t.textContent=n.length-1),e.classList.remove("place__like_active"),t.textContent=o.likes.length})).catch((function(e){console.log(e)}));var c}(m,v,c,f):function(e,t,n,o){return(c=o.id,fetch("".concat(r.baseUrl,"/cards/likes/").concat(c),{method:"PUT",headers:r.headers}).then(a)).then((function(o){e.classList.contains("place__like_active")||(t.textContent=n.length+1),e.classList.add("place__like_active"),t.textContent=o.likes.length})).catch((function(e){console.log(e)}));var c}(m,v,c,f)})),function(e,t){t!==J?e.classList.add("place__delete-button_hidden"):(e.classList.remove("place__delete-button_hidden"),e.addEventListener("click",(function(){p(e)})))}(h,u),_.addEventListener("click",(function e(){t(i),l.src=o,s.textContent=n,l.alt=n,_.removeEventListener("click",e)})),f}d.addEventListener("submit",(function(e){e.preventDefault()}));var v=document.querySelectorAll(".popup__close-icon"),h=document.querySelectorAll(".popup__background"),y=document.querySelector(".popup-edit"),S=document.querySelector("#name"),b=document.querySelector(".profile__name"),L=document.querySelector("#profession"),q=document.querySelector(".profile__profession"),E=document.querySelector("#card-name"),C=document.querySelector("#card-image"),k=document.querySelector(".popup-add"),g=document.querySelector(".grid-places"),x=document.querySelector("#place-template").content,A=document.querySelector(".profile__avatar-wrap"),U=document.querySelector(".profile__avatar-cover"),O=document.querySelector(".popup-avatar"),P=document.querySelector("#avatar-image");function T(e){"Escape"===e.code&&(n(document.querySelector(".popup_opened")),o())}function w(e,t){var n=t.querySelector(".form__submit-button");e?(n.textContent="Сохранение...",n.disabled=!0):(n.textContent="Сохранить",n.disabled=!1)}v.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){n(t),o()}))})),h.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){n(t),o()}))})),A.addEventListener("mouseover",(function(){U.classList.add("profile__avatar-cover_opened")})),A.addEventListener("mouseout",(function(){U.classList.remove("profile__avatar-cover_opened")})),U.addEventListener("click",(function(){O.classList.add("popup_opened")})),O.addEventListener("submit",(function(e){var t;e.preventDefault(),w(!0,O),(t=P.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then(a)).then((function(e){e.ok&&(N.src=e.avatar)})).catch((function(e){console.log(e)})).then(n(O)).finally((function(){w(!1,O)}))}));var D=document.querySelector(".profile__edit-button"),j=document.querySelector(".edit-form"),B=document.querySelector(".profile__add-button"),N=document.querySelector(".profile__avatar"),H=document.querySelectorAll(".place__delete-button"),J="",M="";fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(a).then((function(e){J=e._id,b.textContent=e.name,q.textContent=e.about,N.src=e.avatar})).catch((function(e){console.log(e)})),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(a).then((function(e){e.forEach((function(e){var t=e.name,n=e.link,o=e.likes,c=e.owner,r=e._id,a=m(x,t,n,o,c._id,r);g.append(a),M=r,c._id})),H.forEach((function(e){var t=e.closest(".place").owner._id;console.log(t),t!==J&&e.classList.add("place__delete-button_hidden")}))})).catch((function(e){console.log(e)})),B.addEventListener("click",(function(){t(k),o()})),D.addEventListener("click",(function(){t(y),S.value=b.textContent,L.value=q.textContent})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);c(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),c(n,o,t)}))}))}(t,e)}))}({formSelector:".form",inputSelector:".form__textfield",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_inactive",inputErrorClass:"form__textfield_type_error",errorClass:"form__input-error_active"}),j.addEventListener("submit",(function(e){var t,o;e.preventDefault(),w(!0,y),(t=S.value,o=L.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:t,about:o})}).then(a)).then((function(e){e.ok&&(b.textContent=S.value,q.textContent=L.value)})).catch((function(e){console.log(e)})).then(n(y)).finally((function(){w(!1,y)}))})),u.addEventListener("submit",(function(e){var t,o;e.preventDefault(),w(!0,k),(t=E.value,o=C.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:t,link:o})}).then(a)).then((function(e){if(e.ok){var t=m(x,E.value,C.value,0,J,M);g.prepend(t)}})).catch((function(e){console.log(e)})).then(n(k)).finally((function(){w(!1,k)}))}))})();